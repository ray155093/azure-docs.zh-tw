---
title: "StorSimple 容錯移轉和災害復原 | Microsoft Docs"
description: "了解如何將 StorSimple 裝置容錯移轉至其本身、另一個實體裝置或虛擬裝置。"
services: storsimple
documentationcenter: 
author: alkohli
manager: carmonm
editor: 
ms.assetid: 5751598e-49c8-42b3-8121-fea5857a7d83
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/16/2016
ms.author: alkohli
translationtype: Human Translation
ms.sourcegitcommit: 2ea002938d69ad34aff421fa0eb753e449724a8f
ms.openlocfilehash: bf92ffdb16b86c4033cc96ae2abb060d90f9505e


---
# <a name="failover-and-disaster-recovery-for-your-storsimple-device"></a>StorSimple 裝置的容錯移轉與災害復原
## <a name="overview"></a>概觀
本教學課程說明發生災害時容錯移轉 StorSimple 裝置所需的步驟。 容錯移轉可讓您將資料中心的來源裝置資料移轉至位於相同或不同地理位置的另一個實體或甚至是虛擬裝置。 

災害復原 (DR) 是透過裝置容錯移轉功能來進行協調，並且是從 [裝置]  頁面起始。 此頁面會以表格列出與 StorSimple Manager 服務連接的所有 StorSimple 裝置。 顯示每個裝置的易記名稱、狀態、佈建與最大容量、類型及模型。

![[裝置] 頁面](./media/storsimple-device-failover-disaster-recovery/IC740972.png)

本教學課程中的指導方針適用於跨所有軟體版本的 StorSimple 實體和虛擬裝置。

## <a name="disaster-recovery-dr-and-device-failover"></a>災害復原 (DR) 與裝置容錯移轉
在災害復原 (DR) 案例中，主要裝置會停止運作。 在此情況下，您可以使用主要裝置當做「來源」，並將另一個裝置指定為「目標」，將與失敗裝置相關聯的雲端資料移至另一個裝置。 您可以選取一或多個磁碟區容器來移轉到目標裝置。 這個程序就稱為「容錯移轉」 。 

在容錯移轉期間，來源裝置的磁碟區容器會變更擁有權，並移轉到目標裝置。 在磁碟區容器變更擁有權之後，系統會將這些容器從來源裝置中刪除。 完成刪除之後，目標裝置便可以容錯回復。

緊接在 DR 之後，最新的備份通常用來將資料還原至目標裝置。 不過，如果相同的磁碟區有多個備份原則，則會挑選具有最大量磁碟區的備份原則，而該原則的最新備份可用於還原目標裝置上的資料。

例如，如果有兩個備份原則 (一個是預設原則，一個是自訂原則)，defaultPol、customPol 的詳細資料如下︰

* defaultPol︰一個磁碟區 (vol1) 會於每日下午 10:30 開始執行。
* customPol︰四個磁碟區 (vol1、vol2、vol3、vol4) 會於每日下午 10:00 開始執行。

在此情況下，將會使用 customPol  ，因為它有更多磁碟區，而我們會針對損毀一致性排定優先順序。 此原則的最新備份可用來還原資料。

## <a name="considerations-for-device-failover"></a>裝置容錯移轉考量
萬一發生災害，您可以選擇將 StorSimple 裝置容錯移轉到：

* 實體裝置 
* 其本身
* 虛擬裝置

對於任何裝置容錯移轉，都請記住下列事項：

* DR 的必要條件是磁碟區容器內的所有磁碟區都必須離線，而且磁碟區容器要有相關聯的雲端快照。 
* 適用於 DR 的可用目標裝置是空間足以容納選定磁碟區容器的裝置。 
* 與服務連接但空間不足而不符合條件的裝置，無法當成目標裝置使用。
* 以下的 DR 在一段有限時間中，資料存取效能會受到大幅影響，因為裝置必須從雲端存取資料，然後儲存到本機。

#### <a name="device-failover-across-software-versions"></a>跨軟體版本的裝置容錯移轉
部署中的 StorSimple Manager 服務可能會有多個實體和虛擬裝置，且全都執行不一樣的軟體版本。 依軟體版本而定，裝置上的磁碟區類型也可能不同。 例如，執行 Update 2 或更高版本的裝置會有固定在本機的磁碟區和分層磁碟區 (包含做為分層子集的封存)。 另一方面 pre-Update 2 裝置可能會有分層磁碟區和封存磁碟區。 

您可以使用下表來判斷您是否可以在 DR 期間容錯移轉至另一個執行不同軟體版本的裝置，以及磁碟區類型的行為。

| 容錯移轉自 | 允許實體裝置 | 允許虛擬裝置 |
| --- | --- | --- |
| Update 2 至 pre-Update 1 (版本 0.1、0.2、0.3) |否 |否 |
| Update 2 至 Update 1 (1, 1.1, 1.2) |是 <br></br>如果使用固定在本機的磁碟區或分層磁碟區 (或兩者混合)，磁碟區一律如分層容錯移轉。 |是<br></br>如果使用固定在本機的磁碟區，這些會容錯移轉為分層磁碟區。 |
| Update 2 至 Update 2 (更新版本) |是<br></br>如果使用固定在本機的磁碟區或分層磁碟區 (或兩者混合)，磁碟區一律以起始的磁碟區類型容錯移轉；分層即容錯移轉為分層，固定在本機即容錯移轉為固定在本機。 |是<br></br>如果使用固定在本機的磁碟區，這些會容錯移轉為分層磁碟區。 |

#### <a name="partial-failover-across-software-versions"></a>跨軟體版本的部分容錯移轉
如果您想要將執行 Update 1 之前的 StorSimple 來源裝置部分容錯移轉至執行 Update 1 或更新版本的目標，請依照本指南進行。 

| 部分容錯移轉從 | 允許實體裝置 | 允許虛擬裝置 |
| --- | --- | --- |
| Update 1 之前 (版次 0.1、0.2、0.3) 至 Update 1 或更新版本 |是，請參閱以下的最佳作法提示。 |是，請參閱以下的最佳作法提示。 |

> [!TIP]
> Update 1 及更新版本中的雲端中繼資料和資料格式已變更。 因此，不建議從 Update 1 之前部分容錯移轉至 Update 1 或更新版本。 如果您需要執行部分容錯移轉，建議您先在兩個裝置 (來源和目標) 上套用 Update 1 或更新版本，再繼續容錯移轉。 
> 
> 

## <a name="fail-over-to-another-physical-device"></a>容錯移轉到另一個實體裝置
請執行下列步驟以將裝置還原至目標實體裝置。

1. 確認您要容錯移轉的磁碟區容器是否具有相關聯的雲端快照。
2. 在 [裝置] 頁面上，按一下 [磁碟區容器] 索引標籤。
3. 選取您要容錯移轉至另一個裝置的磁碟區容器。 按一下磁碟區容器，以顯示此容器內的磁碟區清單。 選取磁碟區，然後按一下 [離線]  ，使磁碟區離線。 針對磁碟區容器中的所有磁碟區，重複執行這個程序。
4. 針對您要容錯移轉至另一個裝置的所有磁碟區容器，重複執行前一個步驟。
5. 在 [裝置] 頁面中，按一下 [容錯移轉]。
6. 在隨即開啟的精靈中，於 [選擇要容錯移轉的磁碟區容器] 下：
   
   1. 在磁碟區容器清單中，選取您要容錯移轉的磁碟區容器。
      **只會顯示與雲端快照集和離線磁碟區相關聯的磁碟區容器。**
   2. 在 [為所選取容器中的磁碟區選擇目標裝置]  中，從可用裝置的下拉式清單中選取目標裝置。 下拉式清單中只會顯示具有可用容量的裝置。
   3. 最後，檢閱 [確認容錯移轉] 下的所有容錯移轉設定。 按一下核取圖示 ![核取圖示](./media/storsimple-device-failover-disaster-recovery/IC740895.png)，將與失敗裝置相關聯的雲端資料移至另一個裝置。
7. 將會建立一個可透過 [工作]  頁面監視的容錯移轉作業。 如果要容錯移轉的磁碟區容器包含本機磁碟區，則您會看到容器中每個本機磁碟區 (除分層磁碟區外) 的還原作業。 這些還原作業可能需要一段時間才能完成。 容錯移轉作業可能會較早完成。 請注意，還原作業完成之後這些磁碟區才有本機保證。 完成容錯移轉後，移至 [裝置]  頁面。                                            
   
   1. 為容錯移轉程序選取要用來做為目標裝置的裝置。
   2. 移至 [磁碟區容器]  頁面。 此時應會列出所有磁碟區容器以及舊裝置中的磁碟區。

## <a name="failover-using-a-single-device"></a>使用單一裝置容錯移轉
如果您只有單一裝置且需要執行容錯移轉，請執行下列步驟。

1. 建立裝置中所有磁碟區的雲端快照。
2. 將裝置重設為原廠預設值。 請依照 [如何將 StorSimple 裝置重設為原廠預設值](storsimple-manage-device-controller.md#reset-the-device-to-factory-default-settings)中的詳細指示執行。
3. 設定裝置並再次向 StorSimple Manager 服務註冊。
4. 在 [裝置] 頁面上，舊的裝置應會顯示成 [離線]。 新註冊的裝置應該會顯示成 [上線] 。
5. 對於新的裝置，請先完成最小量裝置組態設定。 
   
   > [!IMPORTANT]
   > **如果不先完成最小量組態設定，您的 DR 會因目前實作中的錯誤而失敗。未來版本中將會修正這個問題。**
   > 
   > 
6. 選取舊裝置 (離線狀態)，然後按一下 [容錯移轉] 。 在呈現的精靈中，容錯移轉這個裝置，並將新註冊的裝置指定為目標裝置。 如需詳細指示，請參閱 [容錯移轉到另一個實體裝置](#fail-over-to-another-physical-device)。
7. 您可以監視從 [工作]  頁面來監視建立的裝置還原工作。
8. 順利完成工作後，請存取新的裝置，並瀏覽到 [磁碟區容器]  頁面。 舊裝置的所有磁碟區容器現在應已移轉到新的裝置。

## <a name="fail-over-to-a-storsimple-virtual-device"></a>容錯移轉到 StorSimple 虛擬裝置
執行此程序之前，您必須已建立並設定 StorSimple 虛擬裝置。 如果執行 Update 2，請考慮針對 DR 使用具有 64 TB，且會使用進階儲存體的 8020 虛擬裝置。 

請執行下列步驟以將裝置還原至目標 StorSimple 虛擬裝置。

1. 確認您要容錯移轉的磁碟區容器是否具有相關聯的雲端快照。
2. 在 [裝置] 頁面上，按一下 [磁碟區容器] 索引標籤。
3. 選取您要容錯移轉至另一個裝置的磁碟區容器。 按一下磁碟區容器，以顯示此容器內的磁碟區清單。 選取磁碟區，然後按一下 [離線]  ，使磁碟區離線。 針對磁碟區容器中的所有磁碟區，重複執行這個程序。
4. 針對您要容錯移轉至另一個裝置的所有磁碟區容器，重複執行前一個步驟。
5. 在 [裝置] 頁面中，按一下 [容錯移轉]。
6. 在隨即開啟的精靈中，於 [選擇要容錯移轉的磁碟區容器] 下，完成下列動作：
   
    a. 在磁碟區容器清單中，選取您要容錯移轉的磁碟區容器。
   
    **只會顯示與雲端快照集和離線磁碟區相關聯的磁碟區容器。**
   
    b.這是另一個 C# 主控台應用程式。 在 [為所選取容器中的磁碟區選擇目標裝置] 下，從可用裝置的下拉式清單中選取 StorSimple 虛擬裝置。 **下拉式清單中只會顯示具有足夠容量的裝置。**  
7. 最後，檢閱 [確認容錯移轉] 下的所有容錯移轉設定。 按一下核取圖示 ![核取圖示](./media/storsimple-device-failover-disaster-recovery/IC740895.png)，將與失敗裝置相關聯的雲端資料移至另一個裝置。
8. 完成容錯移轉後，移至 [裝置]  頁面。
   
    a. 為容錯移轉程序選取要用來做為目標裝置的 StorSimple 虛擬裝置。
   
    b.這是另一個 C# 主控台應用程式。 移至 [磁碟區容器]  頁面。 此時應會列出所有磁碟區容器，以及舊裝置中的磁碟區。

![提供的影片](./media/storsimple-device-failover-disaster-recovery/Video_icon.png) **提供的影片**

若要觀看影片示範如何將失敗的實體裝置還原至雲端中的虛擬裝置，請按一下 [這裡](https://azure.microsoft.com/documentation/videos/storsimple-and-disaster-recovery/)。

## <a name="failback"></a>容錯回復
針對 Update 3 和更新版本，StorSimple 也支援容錯回復。 在容錯移轉完成之後，會進行下列動作：

* 系統會將已容錯移轉的磁碟區容器從來源裝置中清除。
* 在來源裝置上會針對每一磁碟區容器起始一個背景作業 (容錯移轉)。 如果您嘗試在作業進行中時進行容錯回復，您將會收到該項影響的通知。 您將必須等到作業完成後才能開始容錯回復。 
  
    完成磁碟區容器刪除的時間取決於各種因素，例如資料量、資料存留期、備份數目以及作業可用的網路頻寬。 如果您正在規劃測試容錯移轉/容錯回復，建議您以含較少資料 (單位為 Gb) 的磁碟區容器進行測試。 在大多數情況下，您可以在容錯移轉完成之後 24 小時開始進行容錯回復。 

## <a name="frequently-asked-questions"></a>常見問題集
問： **如果 DR 失敗或只有部分成功，會發生什麼狀況？**

A. 如果 DR 失敗，建議您再試一次。 第二次執行時，DR 會知道哪些已全部完成，以及在第一次執行時程序是在何時停止。 DR 程序會從該點繼續執行。 

問： **正在進行裝置容錯移轉時，是否可以刪除裝置？**

A. 您無法在 DR 正在進行時刪除裝置。 只有在 DR 完成之後，您才能刪除裝置。

問：    **何時開始收集來源裝置上的廢棄項目，以便刪除來源裝置上的本機資料？**

A. 只有在完全清理裝置之後，才會在來源裝置上啟用廢棄項目收集。 清理作業包括清理已從來源裝置容錯移轉的物件，例如磁碟區、備份物件 (非資料)、磁碟區容器，以及原則。

問： **如果與來源裝置中磁碟區容器關聯的刪除作業失敗，會發生什麼情況？**

A.  如果刪除作業失敗，您就必須手動觸發磁碟區容器的刪除作業。 在 [裝置] 頁面上，選取您的來源裝置，然後按一下 [磁碟區容器]。 選取您已進行容錯移轉的磁碟區容器，然後在頁面下方按一下 [刪除]。 刪除來源裝置上所有已容錯移轉的磁碟區容器之後，您便可以開始容錯回復。

## <a name="business-continuity-disaster-recovery-bcdr"></a>業務持續性災害復原 (BCDR)
當整個 Azure 資料中心停止運作時，就構成業務持續性災害復原 (BCDR) 狀況。 這會影響您的 StorSimple Manager 服務和相關聯的 StorSimple 裝置。

如果 StorSimple 裝置在發生災害的前一刻才剛註冊，這些 StorSimple 裝置可能需要進行原廠重設。 災害發生後，StorSimple 裝置會顯示為離線。 必須從入口網站刪除 StorSimple 裝置，進行原廠重設，然後重新註冊。

## <a name="next-steps"></a>後續步驟
* 執行容錯移轉之後，您可能需要 [停用或刪除 StorSimple 裝置](storsimple-deactivate-and-delete-device.md)。
* 如需如何使用 StorSimple Manager 服務的相關資訊，請移至 [使用 StorSimple Manager 服務管理 StorSimple 裝置](storsimple-manager-service-administration.md)。




<!--HONumber=Nov16_HO3-->


